<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --danger: #f72585;
            --success: #4cc9f0;
        }
        .health-card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .health-card:hover {
            transform: translateY(-5px);
        }
        .alert-badge {
            position: absolute;
            top: -10px;
            right: -10px;
        }
        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
        }
        .trend-card {
            height: 100%;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary">
                <i class="bi bi-heart-pulse"></i> Health Dashboard
            </h1>
            <div class="text-muted" id="current-time"></div>
        </div>

        <!-- Summary Cards -->
        <div class="row g-4 mb-4">
            <!-- Heart Rate -->
            <div class="col-md-3">
                <div class="health-card card border-primary p-3 position-relative">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">
                            <i class="bi bi-heart"></i> Heart Rate
                        </h5>
                        <div class="metric-value text-primary" id="current-heart-rate">72</div>
                        <small class="text-muted">bpm</small>
                        {% if data[-1].is_anomaly == 1 %}
                        <span class="alert-badge badge bg-danger">ALERT</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Blood Oxygen -->
            <div class="col-md-3">
                <div class="health-card card border-success p-3">
                    <div class="card-body text-center">
                        <h5 class="card-title text-success">
                            <i class="bi bi-lungs"></i> Blood O₂
                        </h5>
                        <div class="metric-value text-success" id="current-blood-oxygen">98</div>
                        <small class="text-muted">% SpO₂</small>
                    </div>
                </div>
            </div>

            <!-- Sleep -->
            <div class="col-md-3">
                <div class="health-card card border-info p-3">
                    <div class="card-body text-center">
                        <h5 class="card-title text-info">
                            <i class="bi bi-moon"></i> Sleep
                        </h5>
                        <div class="metric-value text-info" id="current-sleep">7.5</div>
                        <small class="text-muted">hours</small>
                    </div>
                </div>
            </div>

            <!-- Steps -->
            <div class="col-md-3">
                <div class="health-card card border-warning p-3">
                    <div class="card-body text-center">
                        <h5 class="card-title text-warning">
                            <i class="bi bi-activity"></i> Steps
                        </h5>
                        <div class="metric-value text-warning" id="current-steps">8,240</div>
                        <small class="text-muted">today</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row g-4 mb-4">
            <!-- Heart Rate Chart -->
            <div class="col-md-6">
                <div class="health-card card trend-card p-3">
                    <div class="card-body">
                        <h5 class="card-title">Heart Rate Trend</h5>
                        <canvas id="heartRateChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Blood Oxygen Chart -->
            <div class="col-md-6">
                <div class="health-card card trend-card p-3">
                    <div class="card-body">
                        <h5 class="card-title">Blood Oxygen Trend</h5>
                        <canvas id="bloodOxygenChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="health-card card p-3">
            <div class="card-body">
                <h5 class="card-title mb-3">Recent Readings</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Date</th>
                                <th>Heart Rate</th>
                                <th>Blood O₂</th>
                                <th>Sleep</th>
                                <th>Steps</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in data[-10:] %}
                            <tr class="{% if record.is_anomaly == 1 %}table-danger{% endif %}">
                                <td>{{ record.date }}</td>
                                <td>{{ record.heart_rate }} bpm</td>
                                <td>{{ record.blood_oxygen }}%</td>
                                <td>{{ record.sleep_hours }} hrs</td>
                                <td>{{ record.steps }}</td>
                                <td>
                                    {% if record.is_anomaly == 1 %}
                                    <span class="badge bg-danger">Alert</span>
                                    {% else %}
                                    <span class="badge bg-success">Normal</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Update current time
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Process Flask data
        const healthData = {{ data|tojson }};
        
        // Update summary cards
        document.getElementById('current-heart-rate').textContent = 
            healthData[healthData.length - 1].heart_rate;
        document.getElementById('current-blood-oxygen').textContent = 
            healthData[healthData.length - 1].blood_oxygen;
        document.getElementById('current-sleep').textContent = 
            healthData[healthData.length - 1].sleep_hours;
        document.getElementById('current-steps').textContent = 
            healthData[healthData.length - 1].steps.toLocaleString();

        // Charts
        const dates = healthData.map(item => item.date);
        
        // Heart Rate Chart
        new Chart(
            document.getElementById('heartRateChart'),
            {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Heart Rate (bpm)',
                        data: healthData.map(item => item.heart_rate),
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        tension: 0.3
                    }]
                }
            }
        );

        // Blood Oxygen Chart
        new Chart(
            document.getElementById('bloodOxygenChart'),
            {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Blood Oxygen (%)',
                        data: healthData.map(item => item.blood_oxygen),
                        borderColor: '#4cc9f0',
                        backgroundColor: 'rgba(76, 201, 240, 0.1)',
                        tension: 0.3
                    }]
                }
            }
        );
    </script>
</body>
</html>
